<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–í–∏–∫—Ç–æ—Ä–∏–Ω–∞</title>
<link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="quiz-container">
    <h1>ü©ª Radiology Challenge</h1>
    <div id="question-box">
        <p id="question-text">–û–∂–∏–¥–∞–π—Ç–µ –Ω–∞—á–∞–ª–∞...</p>
        <div id="options"></div>
        <div id="timer"></div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
<script>
const socket = io();
const username = "{{ username }}";
let timerInterval;
socket.emit("join", {username});

socket.on("new_question", () => {
    socket.emit("get_question", {});
});

socket.on("question", data => {
    document.getElementById("question-text").innerText = `${data.index}/${data.total}: ${data.text}`;
    const box = document.getElementById("options");
    box.innerHTML = "";
    data.options.forEach((opt, i) => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.onclick = () => answer(i);
        box.appendChild(btn);
    });
    startTimer(data.time);
});

socket.on("end", data => {
    window.location.href = "/results";
});

function answer(i) {
    socket.emit("answer", {username, answer: i});
    clearInterval(timerInterval);
    document.getElementById("question-text").innerText = "–û—Ç–≤–µ—Ç –ø—Ä–∏–Ω—è—Ç, –∂–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å...";
    document.getElementById("options").innerHTML = "";
}

function startTimer(seconds) {
    const timer = document.getElementById("timer");
    timer.textContent = `‚è± –û—Å—Ç–∞–ª–æ—Å—å ${seconds} —Å–µ–∫`;
    timerInterval = setInterval(() => {
        seconds--;
        if (seconds <= 0) {
            clearInterval(timerInterval);
            timer.textContent = "‚è± –í—Ä–µ–º—è –≤—ã—à–ª–æ!";
        } else {
            timer.textContent = `‚è± –û—Å—Ç–∞–ª–æ—Å—å ${seconds} —Å–µ–∫`;
        }
    }, 1000);
}
</script><script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.min.js"></script>
<script>
  const socket = io();

  const username = "{{ username }}";

  socket.emit('join', { username });

  socket.on('joined', () => {
    console.log("–ü–æ–¥–∫–ª—é—á–µ–Ω–æ!");
  });

  // –ö–æ–≥–¥–∞ –≤–µ–¥—É—â–∏–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∏–≥–Ω–∞–ª –Ω–∞ –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å:
  socket.on('new_question', () => {
    socket.emit('get_question', { username });
  });

  // –ö–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –≤–æ–ø—Ä–æ—Å:
  socket.on('question', (data) => {
    document.getElementById("question").innerText = data.text;
    const opts = data.options.map((o, i) =>
      `<button onclick="sendAnswer(${i})">${o}</button>`
    ).join("");
    document.getElementById("options").innerHTML = opts;
  });

  // –ö–æ–≥–¥–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞:
  socket.on('end', (data) => {
    document.body.innerHTML = `<h2>${data.message}</h2><a href="/results">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</a>`;
  });

  function sendAnswer(i) {
    socket.emit('answer', { username, answer: i });
  }
</script>

</body><h2 id="question">–û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞...</h2>
<div id="options"></div>
</html>

